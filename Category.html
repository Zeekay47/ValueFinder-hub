<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/CollectionPage">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta tags will be set dynamically based on category -->
    <title id="pageTitle">Category Products - ValueFinder Hub</title>
    <meta name="description" id="pageDescription" content="Browse and compare products in this category. Find the best prices from multiple retailers.">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" id="ogUrl" content="">
    <meta property="og:title" id="ogTitle" content="">
    <meta property="og:description" id="ogDescription" content="">
    <meta property="og:image" id="ogImage" content="">
    
    <!-- Canonical URL -->
    <link rel="canonical" id="canonicalUrl" href="">
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json" id="breadcrumbSchema"></script>
    
    <!-- Include common head elements -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/bootstrap-custom.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
</head>
<body>
    <!-- Reuse header from index.html -->
    <header class="sticky-top bg-white shadow-sm">
        <!-- Same header as index.html -->
    </header>

    <main>
        <!-- Breadcrumbs -->
        <nav aria-label="breadcrumb" class="bg-light py-3">
            <div class="container">
                <ol class="breadcrumb mb-0" id="breadcrumbList">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active" id="currentCategory">Category</li>
                </ol>
            </div>
        </nav>

        <!-- Category Header -->
        <section class="py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1 class="display-5 fw-bold mb-3" id="categoryTitle">Category Name</h1>
                        <p class="lead text-muted" id="categoryDescription">
                            Compare prices, read reviews, and find the best deals on top products in this category.
                        </p>
                        <div class="d-flex flex-wrap gap-2 mt-4" id="categoryStats">
                            <span class="badge bg-primary p-2">
                                <i class="bi bi-grid me-1"></i> <span id="productCount">0</span> Products
                            </span>
                            <span class="badge bg-success p-2">
                                <i class="bi bi-shop me-1"></i> <span id="retailerCount">0</span> Retailers
                            </span>
                            <span class="badge bg-warning p-2">
                                <i class="bi bi-star me-1"></i> Average Rating: <span id="avgRating">0.0</span>
                            </span>
                        </div>
                    </div>
                    <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
                        <div class="category-icon-wrapper bg-primary bg-opacity-10 rounded-circle d-inline-flex p-4">
                            <i class="bi bi-laptop fs-1 text-primary" id="categoryIcon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Category Content -->
        <section class="py-4 bg-light">
            <div class="container">
                <div class="row">
                    <!-- Filters Sidebar -->
                    <div class="col-lg-3 mb-4">
                        <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                            <div class="card-body">
                                <h3 class="h5 mb-4">Filter Products</h3>
                                
                                <!-- Price Filter -->
                                <div class="filter-section mb-4">
                                    <h4 class="h6 fw-bold mb-3">Price Range</h4>
                                    <div class="price-slider mb-3">
                                        <label for="priceMin" class="form-label">Min: $<span id="priceMinValue">0</span></label>
                                        <input type="range" class="form-range" id="priceMin" min="0" max="10000" value="0">
                                        <label for="priceMax" class="form-label">Max: $<span id="priceMaxValue">10000</span></label>
                                        <input type="range" class="form-range" id="priceMax" min="0" max="10000" value="10000">
                                    </div>
                                </div>
                                
                                <!-- Brand Filter -->
                                <div class="filter-section mb-4">
                                    <h4 class="h6 fw-bold mb-3">Brands</h4>
                                    <div class="brand-filters" id="brandFilters">
                                        <!-- Brands loaded dynamically -->
                                    </div>
                                </div>
                                
                                <!-- Rating Filter -->
                                <div class="filter-section mb-4">
                                    <h4 class="h6 fw-bold mb-3">Rating</h4>
                                    <div class="rating-filters">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="ratingFilter" id="rating-all" value="0" checked>
                                            <label class="form-check-label" for="rating-all">All Ratings</label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="ratingFilter" id="rating-4" value="4">
                                            <label class="form-check-label" for="rating-4">
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i> & above
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="ratingFilter" id="rating-3" value="3">
                                            <label class="form-check-label" for="rating-3">
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i>
                                                <i class="bi bi-star-fill text-warning"></i> & above
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Retailer Filter -->
                                <div class="filter-section mb-4">
                                    <h4 class="h6 fw-bold mb-3">Available At</h4>
                                    <div class="retailer-filters" id="retailerFilters">
                                        <!-- Retailers loaded dynamically -->
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                                    <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear All</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div class="col-lg-9">
                        <!-- Sorting Options -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span id="filteredCount">Showing 0 products</span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <label for="sortSelect" class="me-2 mb-0">Sort by:</label>
                                        <select class="form-select form-select-sm w-auto" id="sortSelect" onchange="sortProducts(this.value)">
                                            <option value="relevance">Relevance</option>
                                            <option value="price-low">Price: Low to High</option>
                                            <option value="price-high">Price: High to Low</option>
                                            <option value="rating">Highest Rated</option>
                                            <option value="popularity">Most Popular</option>
                                            <option value="newest">Newest First</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Products Grid -->
                        <div class="row g-4" id="productsGrid">
                            <!-- Products loaded dynamically -->
                        </div>
                        
                        <!-- Loading State -->
                        <div id="loadingState" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-muted">Loading products...</p>
                        </div>
                        
                        <!-- No Results -->
                        <div id="noResults" class="text-center py-5 d-none">
                            <i class="bi bi-search fs-1 text-muted mb-3"></i>
                            <h4>No products found</h4>
                            <p class="text-muted">Try adjusting your filters or browse other categories.</p>
                            <button class="btn btn-primary" onclick="clearFilters()">Clear Filters</button>
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Product pagination" class="mt-5">
                            <ul class="pagination justify-content-center" id="pagination">
                                <!-- Pagination loaded dynamically -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Category Information -->
        <section class="py-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4 p-lg-5">
                                <h2 class="h3 mb-4">About This Category</h2>
                                <div id="categoryContent">
                                    <!-- Category content loaded dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Reuse footer from index.html -->
    <footer class="bg-dark text-white pt-5 pb-4">
        <!-- Same footer as index.html -->
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/products.js"></script>
    <script src="js/main.js"></script>
    <script src="js/seo.js"></script>
    
    <script>
        let currentCategory = '';
        let currentProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const productsPerPage = 12;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get category from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentCategory = urlParams.get('cat') || 'electronics';
            
            // Load category page
            loadCategoryPage(currentCategory);
        });
        
        function loadCategoryPage(categoryId) {
            // Show loading state
            document.getElementById('productsGrid').innerHTML = '';
            document.getElementById('loadingState').classList.remove('d-none');
            document.getElementById('noResults').classList.add('d-none');
            
            // Load category data
            fetch('data/categories.json')
                .then(response => response.json())
                .then(categories => {
                    const category = categories.find(c => c.id === categoryId);
                    
                    if (category) {
                        // Update page metadata
                        updatePageMetadata(category);
                        
                        // Update UI
                        document.getElementById('categoryTitle').textContent = category.name;
                        document.getElementById('categoryDescription').textContent = category.description || '';
                        document.getElementById('categoryIcon').className = `bi bi-${category.icon} fs-1 text-primary`;
                        
                        // Update breadcrumb
                        const breadcrumbList = document.getElementById('breadcrumbList');
                        breadcrumbList.innerHTML = `
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item active">${category.name}</li>
                        `;
                        
                        // Load category content
                        if (category.content) {
                            document.getElementById('categoryContent').innerHTML = category.content;
                        }
                    }
                    
                    // Load products
                    return fetch('data/products.json');
                })
                .then(response => response.json())
                .then(products => {
                    currentProducts = products.filter(p => p.category === categoryId);
                    filteredProducts = [...currentProducts];
                    
                    // Update stats
                    updateCategoryStats();
                    
                    // Load filters
                    loadFilters();
                    
                    // Load products
                    renderProducts();
                    
                    // Hide loading state
                    document.getElementById('loadingState').classList.add('d-none');
                })
                .catch(error => {
                    console.error('Error loading category:', error);
                    document.getElementById('loadingState').innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Error loading products. Please try again.
                        </div>
                    `;
                });
        }
        
        function updatePageMetadata(category) {
            // Update title
            document.title = `${category.name} - Compare Prices & Reviews | ValueFinder Hub`;
            
            // Update meta description
            document.querySelector('meta[name="description"]').setAttribute('content', 
                `Compare prices and read reviews for ${category.name}. Find the best deals from Amazon, Walmart, Target and more.`
            );
            
            // Update canonical URL
            const canonicalUrl = `https://valuefinderhub.com/category.html?cat=${category.id}`;
            document.querySelector('link[rel="canonical"]').setAttribute('href', canonicalUrl);
            
            // Update Open Graph
            document.querySelector('meta[property="og:title"]').setAttribute('content', `${category.name} - ValueFinder Hub`);
            document.querySelector('meta[property="og:description"]').setAttribute('content', 
                `Compare ${category.name} prices across multiple retailers. Find the best deals and read expert reviews.`
            );
            document.querySelector('meta[property="og:url"]').setAttribute('content', canonicalUrl);
            
            // Update breadcrumb schema
            const breadcrumbSchema = {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": [{
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://valuefinderhub.com/"
                }, {
                    "@type": "ListItem",
                    "position": 2,
                    "name": category.name,
                    "item": canonicalUrl
                }]
            };
            document.getElementById('breadcrumbSchema').textContent = JSON.stringify(breadcrumbSchema);
            
            // Add CollectionPage schema
            const collectionSchema = {
                "@context": "https://schema.org",
                "@type": "CollectionPage",
                "name": `${category.name} - Product Comparisons`,
                "description": `Compare ${category.name} products from multiple retailers`,
                "url": canonicalUrl,
                "mainEntity": {
                    "@type": "ItemList",
                    "itemListElement": []
                }
            };
            
            const schemaScript = document.createElement('script');
            schemaScript.type = 'application/ld+json';
            schemaScript.textContent = JSON.stringify(collectionSchema);
            document.head.appendChild(schemaScript);
        }
        
        function updateCategoryStats() {
            const productCount = currentProducts.length;
            const avgRating = productCount > 0 ? 
                (currentProducts.reduce((sum, p) => sum + (p.rating || 0), 0) / productCount).toFixed(1) : '0.0';
            
            // Count unique retailers
            const retailers = new Set();
            currentProducts.forEach(product => {
                if (product.retailers) {
                    product.retailers.forEach(r => retailers.add(r.name));
                }
            });
            
            document.getElementById('productCount').textContent = productCount;
            document.getElementById('retailerCount').textContent = retailers.size;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('filteredCount').textContent = `Showing ${productCount} products`;
        }
        
        function loadFilters() {
            // Load brands
            const brands = [...new Set(currentProducts.map(p => p.brand).filter(Boolean))].sort();
            const brandFilters = document.getElementById('brandFilters');
            brandFilters.innerHTML = brands.map(brand => `
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand-${brand.replace(/\s+/g, '-')}" value="${brand}">
                    <label class="form-check-label" for="brand-${brand.replace(/\s+/g, '-')}">${brand}</label>
                </div>
            `).join('');
            
            // Load retailers
            const retailers = new Set();
            currentProducts.forEach(product => {
                if (product.retailers) {
                    product.retailers.forEach(r => retailers.add(r.name));
                }
            });
            const retailerList = Array.from(retailers).sort();
            const retailerFilters = document.getElementById('retailerFilters');
            retailerFilters.innerHTML = retailerList.map(retailer => `
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="retailer-${retailer.replace(/\s+/g, '-')}" value="${retailer}">
                    <label class="form-check-label" for="retailer-${retailer.replace(/\s+/g, '-')}">${retailer}</label>
                </div>
            `).join('');
            
            // Initialize price slider
            const prices = currentProducts.map(p => getBestProductPrice(p)).filter(p => p > 0);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            
            const priceMin = document.getElementById('priceMin');
            const priceMax = document.getElementById('priceMax');
            const priceMinValue = document.getElementById('priceMinValue');
            const priceMaxValue = document.getElementById('priceMaxValue');
            
            priceMin.min = minPrice;
            priceMin.max = maxPrice;
            priceMin.value = minPrice;
            priceMax.min = minPrice;
            priceMax.max = maxPrice;
            priceMax.value = maxPrice;
            
            priceMinValue.textContent = minPrice;
            priceMaxValue.textContent = maxPrice;
            
            priceMin.addEventListener('input', function() {
                priceMinValue.textContent = this.value;
                if (parseInt(this.value) > parseInt(priceMax.value)) {
                    priceMax.value = this.value;
                    priceMaxValue.textContent = this.value;
                }
            });
            
            priceMax.addEventListener('input', function() {
                priceMaxValue.textContent = this.value;
                if (parseInt(this.value) < parseInt(priceMin.value)) {
                    priceMin.value = this.value;
                    priceMinValue.textContent = this.value;
                }
            });
        }
        
        function applyFilters() {
            const minPrice = parseInt(document.getElementById('priceMin').value);
            const maxPrice = parseInt(document.getElementById('priceMax').value);
            const minRating = parseFloat(document.querySelector('input[name="ratingFilter"]:checked').value);
            
            // Get selected brands
            const selectedBrands = Array.from(document.querySelectorAll('.brand-filters input:checked'))
                .map(cb => cb.value);
            
            // Get selected retailers
            const selectedRetailers = Array.from(document.querySelectorAll('.retailer-filters input:checked'))
                .map(cb => cb.value);
            
            filteredProducts = currentProducts.filter(product => {
                // Price filter
                const price = getBestProductPrice(product);
                if (price < minPrice || price > maxPrice) return false;
                
                // Rating filter
                if (minRating > 0 && (product.rating || 0) < minRating) return false;
                
                // Brand filter
                if (selectedBrands.length > 0 && !selectedBrands.includes(product.brand)) return false;
                
                // Retailer filter
                if (selectedRetailers.length > 0) {
                    const hasRetailer = product.retailers?.some(r => selectedRetailers.includes(r.name));
                    if (!hasRetailer) return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            renderProducts();
        }
        
        function clearFilters() {
            // Reset all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Reset radio buttons
            document.getElementById('rating-all').checked = true;
            
            // Reset price slider
            const prices = currentProducts.map(p => getBestProductPrice(p)).filter(p => p > 0);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            
            document.getElementById('priceMin').value = minPrice;
            document.getElementById('priceMax').value = maxPrice;
            document.getElementById('priceMinValue').textContent = minPrice;
            document.getElementById('priceMaxValue').textContent = maxPrice;
            
            filteredProducts = [...currentProducts];
            currentPage = 1;
            renderProducts();
        }
        
        function sortProducts(sortBy) {
            switch(sortBy) {
                case 'price-low':
                    filteredProducts.sort((a, b) => getBestProductPrice(a) - getBestProductPrice(b));
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => getBestProductPrice(b) - getBestProductPrice(a));
                    break;
                case 'rating':
                    filteredProducts.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'popularity':
                    filteredProducts.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
            }
            
            currentPage = 1;
            renderProducts();
        }
        
        function renderProducts() {
            const container = document.getElementById('productsGrid');
            const noResults = document.getElementById('noResults');
            
            if (filteredProducts.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('d-none');
                return;
            }
            
            noResults.classList.add('d-none');
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);
            
            // Render products
            container.innerHTML = pageProducts.map(product => renderProductCard(product)).join('');
            
            // Update filtered count
            document.getElementById('filteredCount').textContent = 
                `Showing ${startIndex + 1}-${Math.min(endIndex, filteredProducts.length)} of ${filteredProducts.length} products`;
            
            // Render pagination
            renderPagination(totalPages);
        }
        
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            // Next button
            html += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = html;
        }
        
        function changePage(page) {
            currentPage = page;
            renderProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function getBestProductPrice(product) {
            if (!product.retailers || product.retailers.length === 0) return 0;
            const prices = product.retailers.filter(r => r.price > 0).map(r => r.price);
            return prices.length > 0 ? Math.min(...prices) : 0;
        }
    </script>
</body>
</html>
